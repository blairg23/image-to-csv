[tox]
envlist = py312, lint, type
isolated_build = true

[testenv]
deps = pytest
commands = pytest tests
basepython = python3.12

[testenv:lint]
skip_install = true
deps =
    black
    ruff
commands =
    black src tests
    ruff check src tests --fix

[testenv:type]
skip_install = true
deps = mypy
commands = mypy src

[testenv:zip]
description = Build image_to_csv_project.zip under artifacts directory
skip_install = true
allowlist_externals =
    rm
    mkdir
    zip
commands =
    rm -f artifacts/image_to_csv_repo.zip
    mkdir -p artifacts
    zip -r artifacts/image_to_csv_repo.zip . \
        -x ".git/*" \
        -x ".venv/*" \
        -x "__pycache__/*" -x "**/__pycache__/*" \
        -x "*.pyc" -x "*.pyo" -x "*.pyd" \
        -x ".pytest_cache/*" -x "**/.pytest_cache/*" \
        -x ".mypy_cache/*" -x "**/.mypy_cache/*" \
        -x ".ruff_cache/*" -x "**/.ruff_cache/*" \
        -x ".coverage" -x "coverage.xml" -x "htmlcov/*" \
        -x "dist/*" -x "build/*" \
        -x "*.egg-info/*" -x "**/*.egg-info/*" \
        -x ".tox/*" \
        -x ".DS_Store"
